## `estimation-ui-app` 作成のための詳細プロンプト

### プロンプトのタイトル

**【POC用】Azure 見積もり支援エージェント UI（`estimation-ui-app`）開発指示書**

---

### 目的

Azure App Service 上で動作する Web アプリケーションを開発する。  
ユーザーからの要件（案件概要・スコープ・前提条件など）を受け取り、`estimation-agent-core` に対してAPIリクエストを送信し、返ってきた **見積もり結果HTML** を画面に表示する。

- `estimation-agent-core` から返却される `rationale` フィールドには、**8pxグリッドを前提とした生のHTML** が含まれる。
- UI側は、このHTMLをエスケープせずに埋め込み、共通CSSを適用して **そのまま表示** する。

---

### 技術スタックと設計方針

| 項目                  | 指定値                                       | 備考                                            |
| --------------------- | -------------------------------------------- | ----------------------------------------------- |
| 言語 / フレームワーク | Python / Flask                               | シンプル性と Azure App Service との相性を優先   |
| デプロイ先            | Azure App Service                            | Linux プラン想定                                |
| 通信先                | `estimation-agent-core` のHTTPエンドポイント | 環境変数でURLを指定                             |
| 画面レンダリング      | Flaskテンプレート + バニラJavaScript         | SPAまでは不要。最小限のJSで非同期通信を行う。   |
| デザイン基盤          | **8pxグリッドシステム**に基づくCSS設計       | マージン・パディング・ライン高さを8px単位で統一 |
| 文字コード / 言語     | UTF-8 / 日本語メインだが、英数字も読みやすく | B2B向けのビジネス文書想定                       |

---

### 必須画面構成

1. **ヘッダー**
   - プロジェクト名（例：`AI見積もり支援エージェント POC`）
   - シンプルなロゴ／テキストロゴ
   - 左余白・上下余白ともに 8px の倍数で調整する。

2. **入力フォームエリア**
   - 案件名（テキスト）
   - 概要（テキストエリア）
   - 対象範囲（テキストエリア、または複数チェックボックス）
   - 想定期間・規模などの入力欄（任意）
   - 「見積もり生成」ボタン  
      → すべてのフォーム要素間の間隔・行間を 8px の倍数に揃える。

3. **ステータス表示エリア**
   - 送信開始〜完了までの状態をテキストで表示する領域。
   - 例：
     - 「入力内容をAgent Coreに送信しました。見積もりを生成しています…」
     - 「計算サービスとナレッジベースから情報を取得中です…」
     - 「見積もり生成が完了しました。」

4. **結果表示エリア**
   - `estimation-agent-core` から返却された `rationale`（HTMLテキスト）を、そのまま `innerHTML` として挿入するコンテナ。
   - コンテナ自体には、8pxグリッド想定のクラス（例：`.result-container`）を付与し、  
      行間・段落余白などをCSSで8px単位に整える。

---

### 処理フロー（バックエンド／フロント連携）

1. **フォーム送信時の処理**
   - JavaScript でフォームの submit をフックし、ページリロードを防ぐ。
   - 入力値を JSON 形式にまとめる。

   ```jsonc
   {
     "project_name": "新サービスUX改善プロジェクト",
     "summary": "既存WebサービスのUI/UX改善に伴う工数見積もり",
     "scope": "要件整理〜デザイン〜フロント実装まで",
     "constraints": "期間3ヶ月、PM1名・デザイナー1名・エンジニア2名を想定",
   }
   ```

2. **Agent CoreへのAPI呼び出し**
   - `AGENT_CORE_API_URL`（環境変数）に向けて `POST /estimate` のようなエンドポイントを呼び出す。
   - 非同期通信（`fetch` など）で行い、UIスレッドをブロックしない。

3. **ステータス更新**
   - 送信直後にステータス表示エリアを更新し、  
      「Agent Core に処理を引き渡しました。RAG検索と計算サービスと連携して見積もりを生成しています…」と表示。
   - ボタンを一時的に無効化し、連打による多重送信を防止。

4. **レスポンス処理**
   - Agent Core からのJSONレスポンスを受け取る。想定構造例：
     ```jsonc
     {
       "estimated_amount": 3200000,
       "currency": "JPY",
       "rationale": "<section class=\"doc doc--8px\">...</section>",
       "status": "success",
     }
     ```
   - `estimated_amount` は数値として別途ヘッダー近くに表示してもよい。
   - `rationale` は HTML として結果エリアに挿入する。

5. **エラー処理**
   - ステータスコードが 200 以外の場合、または `status != "success"` の場合、
     - ステータスエリアに「エラーが発生しました。時間をおいて再実行してください。」と表示。
     - コンソールログに詳細エラーを出力。

---

### 8pxグリッドに関するCSS指示

- ベースラインとなるユーティリティクラスを用意する（例）：
  ```css
  .mt-8 {
    margin-top: 8px;
  }
  .mt-16 {
    margin-top: 16px;
  }
  .p-8 {
    padding: 8px;
  }
  .p-16 {
    padding: 16px;
  }
  .gap-8 {
    gap: 8px;
  }
  ```
- 見積もり結果のHTMLは、Agent Core側で `.doc--8px` のようなクラスを付与してくる前提とし、UI側ではそのクラスに対して
  - 段落余白 `margin-bottom: 8px;`
  - 見出し余白 `margin-top: 16px;`  
     などを設定する。

---

### 想定ファイル構成（例）

```text
estimation-ui-app/
├── app.py              # Flaskエントリポイント
├── templates/
│   └── index.html      # 入力フォーム + 結果表示エリア
├── static/
│   ├── css/
│   │   └── style.css   # 8pxグリッド対応CSS
│   └── js/
│       └── main.js     # フォーム送信・API呼び出しロジック
└── requirements.txt    # Flaskなどの依存パッケージ
```

---

### 次のステップ

この開発指示書に従って、P1フェーズ（基盤構築）に必要な `estimation-ui-app` のコードと構造を生成してください。

P1でUIが完成し、`estimation-agent-core` の仮エンドポイントと接続できたら、  
P2フェーズで以下の連携を進めます。

1. Agent Core の **RAG（ナレッジ）接続**
2. Agent Core から **Azure Functions（`calculation-logic-func`）の呼び出し** を行う設定
